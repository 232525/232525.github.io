<!DOCTYPE html><html lang="en" ><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="generator" content="Jekyll v4.2.2" /><meta property="og:title" content="Qwen-VL" /><meta name="author" content="curya" /><meta property="og:locale" content="en" /><meta name="description" content="论文标题：Qwen2.5-VL Technical Report" /><meta property="og:description" content="论文标题：Qwen2.5-VL Technical Report" /><link rel="canonical" href="https://232525.github.io/posts/Qwen-VL/" /><meta property="og:url" content="https://232525.github.io/posts/Qwen-VL/" /><meta property="og:site_name" content="Yiyu Wang" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2025-10-21T00:00:00+08:00" /><meta name="twitter:card" content="summary" /><meta property="twitter:title" content="Qwen-VL" /><meta name="twitter:site" content="@ricardo232525" /><meta name="twitter:creator" content="@curya" /> <script type="application/ld+json"> {"@context":"https://schema.org","@type":"BlogPosting","author":{"@type":"Person","name":"curya"},"dateModified":"2025-10-25T12:31:13+08:00","datePublished":"2025-10-21T00:00:00+08:00","description":"论文标题：Qwen2.5-VL Technical Report","headline":"Qwen-VL","mainEntityOfPage":{"@type":"WebPage","@id":"https://232525.github.io/posts/Qwen-VL/"},"url":"https://232525.github.io/posts/Qwen-VL/"}</script><title>Qwen-VL | Yiyu Wang</title><link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png"><link rel="manifest" href="/assets/img/favicons/site.webmanifest"><link rel="shortcut icon" href="/assets/img/favicons/favicon.ico"><meta name="apple-mobile-web-app-title" content="Yiyu Wang"><meta name="application-name" content="Yiyu Wang"><meta name="msapplication-TileColor" content="#da532c"><meta name="msapplication-config" content="/assets/img/favicons/browserconfig.xml"><meta name="theme-color" content="#ffffff"><link rel="preconnect" href="https://fonts.googleapis.com" ><link rel="dns-prefetch" href="https://fonts.googleapis.com" ><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin><link rel="dns-prefetch" href="https://fonts.gstatic.com" crossorigin><link rel="preconnect" href="https://fonts.googleapis.com" ><link rel="dns-prefetch" href="https://fonts.googleapis.com" ><link rel="preconnect" href="https://cdn.jsdelivr.net" ><link rel="dns-prefetch" href="https://cdn.jsdelivr.net" ><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Lato&family=Source+Sans+Pro:wght@400;600;700;900&display=swap"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4/dist/css/bootstrap.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.11.2/css/all.min.css"><link rel="stylesheet" href="/assets/css/style.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/magnific-popup@1/dist/magnific-popup.min.css"> <script src="https://cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script> <script type="text/javascript"> class ModeToggle { static get MODE_KEY() { return "mode"; } static get MODE_ATTR() { return "data-mode"; } static get DARK_MODE() { return "dark"; } static get LIGHT_MODE() { return "light"; } static get ID() { return "mode-toggle"; } constructor() { if (this.hasMode) { if (this.isDarkMode) { if (!this.isSysDarkPrefer) { this.setDark(); } } else { if (this.isSysDarkPrefer) { this.setLight(); } } } let self = this; /* always follow the system prefers */ this.sysDarkPrefers.addEventListener("change", () => { if (self.hasMode) { if (self.isDarkMode) { if (!self.isSysDarkPrefer) { self.setDark(); } } else { if (self.isSysDarkPrefer) { self.setLight(); } } self.clearMode(); } self.notify(); }); } /* constructor() */ get sysDarkPrefers() { return window.matchMedia("(prefers-color-scheme: dark)"); } get isSysDarkPrefer() { return this.sysDarkPrefers.matches; } get isDarkMode() { return this.mode === ModeToggle.DARK_MODE; } get isLightMode() { return this.mode === ModeToggle.LIGHT_MODE; } get hasMode() { return this.mode != null; } get mode() { return sessionStorage.getItem(ModeToggle.MODE_KEY); } /* get the current mode on screen */ get modeStatus() { if (this.isDarkMode || (!this.hasMode && this.isSysDarkPrefer)) { return ModeToggle.DARK_MODE; } else { return ModeToggle.LIGHT_MODE; } } setDark() { $('html').attr(ModeToggle.MODE_ATTR, ModeToggle.DARK_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.DARK_MODE); } setLight() { $('html').attr(ModeToggle.MODE_ATTR, ModeToggle.LIGHT_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.LIGHT_MODE); } clearMode() { $('html').removeAttr(ModeToggle.MODE_ATTR); sessionStorage.removeItem(ModeToggle.MODE_KEY); } /* Notify another plugins that the theme mode has changed */ notify() { window.postMessage({ direction: ModeToggle.ID, message: this.modeStatus }, "*"); } } /* ModeToggle */ const toggle = new ModeToggle(); function flipMode() { if (toggle.hasMode) { if (toggle.isSysDarkPrefer) { if (toggle.isLightMode) { toggle.clearMode(); } else { toggle.setLight(); } } else { if (toggle.isDarkMode) { toggle.clearMode(); } else { toggle.setDark(); } } } else { if (toggle.isSysDarkPrefer) { toggle.setLight(); } else { toggle.setDark(); } } toggle.notify(); } /* flipMode() */ </script><body data-spy="scroll" data-target="#toc" data-topbar-visible="true"><div id="sidebar" class="d-flex flex-column align-items-end"><div class="profile-wrapper text-center"><div id="avatar"> <a href="/" alt="avatar" class="mx-auto"> <img src=" /assets/img/favicons/android-chrome-512x512.png " alt="avatar" onerror="this.style.display='none'"> </a></div><div class="site-title mt-3"> <a href="/">Yiyu Wang</a></div><div class="site-subtitle font-italic">没人枪毙你，你就活着！</div></div><ul class="w-100"><li class="nav-item"> <a href="/" class="nav-link"> <i class="fa-fw fas fa-home ml-xl-3 mr-xl-3 unloaded"></i> <span>HOME</span> </a><li class="nav-item"> <a href="/categories/" class="nav-link"> <i class="fa-fw fas fa-stream ml-xl-3 mr-xl-3 unloaded"></i> <span>CATEGORIES</span> </a><li class="nav-item"> <a href="/tags/" class="nav-link"> <i class="fa-fw fas fa-tag ml-xl-3 mr-xl-3 unloaded"></i> <span>TAGS</span> </a><li class="nav-item"> <a href="/archives/" class="nav-link"> <i class="fa-fw fas fa-archive ml-xl-3 mr-xl-3 unloaded"></i> <span>ARCHIVES</span> </a><li class="nav-item"> <a href="/about/" class="nav-link"> <i class="fa-fw fas fa-info-circle ml-xl-3 mr-xl-3 unloaded"></i> <span>ABOUT ME</span> </a><li class="nav-item"> <a href="/about_cn/" class="nav-link"> <i class="fa-fw fa fa-user-circle ml-xl-3 mr-xl-3 unloaded"></i> <span>个人简介</span> </a></ul><div class="sidebar-bottom mt-auto d-flex flex-wrap justify-content-center align-items-center"> <button class="mode-toggle btn" aria-label="Switch Mode"> <i class="fas fa-adjust"></i> </button> <span class="icon-border"></span> <a href="https://github.com/232525" aria-label="github" target="_blank" rel="noopener"> <i class="fab fa-github"></i> </a> <a href=" javascript:location.href = 'mailto:' + ['wangyiyu18','mails.ucas.ac.cn'].join('@')" aria-label="email" > <i class="fas fa-envelope"></i> </a> <a href="https://blog.csdn.net/ricardo232525" aria-label="csdn" target="_blank" rel="noopener"> <i class="fas fa-link"></i> </a> <a href="/feed.xml" aria-label="rss" > <i class="fas fa-rss"></i> </a></div></div><div id="topbar-wrapper" class="row justify-content-center"><div id="topbar" class="col-11 d-flex h-100 align-items-center justify-content-between"> <span id="breadcrumb"> <span> <a href="/"> Home </a> </span> <span>Qwen-VL</span> </span> <i id="sidebar-trigger" class="fas fa-bars fa-fw"></i><div id="topbar-title"> Post</div><i id="search-trigger" class="fas fa-search fa-fw"></i> <span id="search-wrapper" class="align-items-center"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" aria-label="search" autocomplete="off" placeholder="Search..."> </span> <span id="search-cancel" >Cancel</span></div></div><div id="main-wrapper"><div id="main"><div class="row"><div id="core-wrapper" class="col-12 col-lg-11 col-xl-8"><div class="post pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><h1 data-toc-skip>Qwen-VL</h1><div class="post-meta text-muted"><div> By <em> <a href="https://github.com/232525">Yiyu Wang</a> </em></div><div class="d-flex"><div> <span> Posted <em class="timeago" data-ts="1760976000" data-toggle="tooltip" data-placement="bottom" data-tooltip-df="llll" > 2025-10-21 </em> </span> <span> Updated <em class="timeago" data-ts="1761366673" data-toggle="tooltip" data-placement="bottom" data-tooltip-df="llll" > 2025-10-25 </em> </span> <span class="readtime" data-toggle="tooltip" data-placement="bottom" title="5653 words"> <em>31 min</em> read</span></div></div></div><div class="post-content"><p>论文标题：Qwen2.5-VL Technical Report</p><p><strong>核心</strong></p><ul><li>模型能力：<ul><li>更强的视觉识别、精准的目标定位、稳健的文档解析、长视频理解（能够使用「边界框/点」准确定位目标，可以对发票、表单和表格等结构化数据进行稳健信息抽取，对图表、示意图、布局等进行详细分析）<li>交互式视觉智能体：具备推理、工具使用和任务执行能力，能够胜任如操作电脑、移动设备等真实场景</ul><li><strong>动态分辨率处理</strong> &amp; <strong>绝对时间编码</strong>：可以处理不同分辨率的图像和时长达数小时的视频，具备秒级事件定位能力（<em>赋予模型原生的空间尺寸和时间动态感知能力，无需依赖传统归一化技术</em>）。<ul><li>从零训练原生动态分辨率的ViT（native dynamic-resolution Vision Transformer），并引入了窗口注意力机制，在保留原生分辨率的同时大幅降低计算开销</ul></ul><h2 id="1-introduction"><span class="mr-2">1. Introduction</span><a href="#1-introduction" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2></h2><p>主流范式：视觉编码器、跨模态投影层、LLM</p><p>面临问题：计算复杂度高、上下文理解有限、细粒度视觉感知能力弱以及在不同序列长度下性能不稳定等问题。</p><p>Qwen2.5-VL：细粒度感知能力，具体贡献如下</p><ol><li>在视觉编码器中实现了<strong>窗口注意力机制</strong>，以优化推理效率；<li>引入<strong>动态帧率采样</strong>，将动态分辨率扩展到<strong>时间维度</strong>，实现对不同采样率视频的全面理解；<li>在<strong>时间域升级了 MRoPE</strong>，通过对齐绝对时间，促进了更高效的时间序列学习；<li>在<strong>高质量数据</strong>整理方面做出了重大努力，无论是预训练还是有监督微调，并将预训练语料库规模从 1.2T 扩展到 4.1T tokens。</ol><p>Qwen2.5-VL的突出特性包括：</p><ul><li>强大的文档解析能力：Qwen2.5-VL将文本识别升级为全能文档解析，在多场景、多语言及多种内嵌（如手写、表格、图表、化学公式、乐谱）文档处理方面表现卓越。<li>跨格式的精准目标定位：Qwen2.5-VL在目标检测、指认和计数方面显著提升了准确性，支持<strong>绝对坐标</strong>和JSON格式，实现高级空间推理。<li>超长视频理解与细粒度视频定位：模型将原生动态分辨率扩展到时间维度，能够理解时长达数小时的视频，并在秒级范围内提取事件片段。<li>增强的终端智能体能力：模型具备高级的定位、推理和决策能力，极大提升了其在手机和电脑等终端设备上的智能体功能。</ul><h2 id="2-方法"><span class="mr-2">2. 方法</span><a href="#2-方法" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2></h2><p>视觉编码器：在结构上，融入了FFN with SwiGLU、RMSNorm、窗口注意力 –&gt; 提升性能 &amp; 效率</p><ul><li>原生分辨率处理、动态帧率采样：不同尺寸的图像和不同帧率的视频会映射为不同长度的token序列<li>MRoPE：多模态位置编码，能够在事件维度将时间ID与绝对时间对齐，使模型能够更好理解时间动态（如事件节奏、精确时刻的定位）。 <img src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 2938 2560'%3E%3C/svg%3E" width="2938" height="2560" alt="image" data-src="https://github.com/user-attachments/assets/b000a72e-ef3c-4a9a-8195-bb1dc66ba0df" data-proofer-ignore></ul><h3 id="21-模型结构"><span class="mr-2">2.1 模型结构</span><a href="#21-模型结构" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3></h3><p>Qwen2.5-VL模型包含3个模块：</p><ul><li>LLM：模型初始化自Qwen2.5的预训练权重。1D RoPE –&gt; MRoPE，实现与绝对时间对齐。<li>Vision Encoder：重新设计的ViT架构。结合2D-RoPE和窗口注意力，支持原生分辨率&amp;加速视觉编码器计算效率。训练&amp;推理过程中，输入图像的宽高会调整为28的倍数输入，patch切分的步幅是14。<li>MLP-based Vision-Language Merger：MLP映射，图像特征压缩&amp;维度对齐。空间相邻4个patch特征分组、拼接，MLP进行映射，投影到LLM维度。</ul><p>不同尺寸的Qwen2.5-VL的结构如下（视觉编码器尺寸都是一样的）： <img src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 2504 1816'%3E%3C/svg%3E" width="2504" height="1816" alt="image" data-src="https://github.com/user-attachments/assets/04726a4c-03ac-4fa8-bdee-516d7882d8e6" data-proofer-ignore></p><h4 id="211-视觉编码器"><span class="mr-2">2.1.1 视觉编码器</span><a href="#211-视觉编码器" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4></h4><p><strong>问题</strong>：处理原生分辨率（有的大有的小），导致训练/推理计算负载不均衡。</p><p><strong>优化</strong>：</p><ol><li>引入窗口注意力（4个层使用全局注意力，其余层使用窗口注意力，尺寸为112x112）<li>采用2D RoPE，捕获二维空间中的位置关系<li>视频处理：扩展到三维patch分割，14x14作为patch基本单元，对视频采用两个连续视频帧作为一组<li>模型结构：RMSNorm、SwiGLU，提升视觉和语言之间的计算效率和兼容性 –&gt; 和语言模型的结构设计对齐，保持一致<li>训练：从头训练，CLIP预训练、视觉-语言对齐、端到端微调多个阶段；原生分辨率动态采样，按照图片的原始长宽比进行随机采样，从而提升模型对不同分辨率输入的泛化能力</ol><h4 id="212-原生动态分辨率帧率"><span class="mr-2">2.1.2 原生动态分辨率&amp;帧率</span><a href="#212-原生动态分辨率帧率" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4></h4><p>空间域：Qwen2.5-VL能够动态地将不同尺寸的图像转换为对应长度的token序列。</p><ul><li>使用输入图像的实际尺寸（<strong>绝对坐标</strong>）表示边界框、点及其他空间特征，使模型能够原生学习尺度信息，提升其处理不同分辨率图像的能力。（<strong>但是在Qwen3-VL又换回了相对坐标</strong>）</ul><p>视频输入：Qwen2.5-VL引入了<strong>动态帧率</strong>（FPS）训练和<strong>绝对时间编码</strong>。</p><ul><li>通过适应不同帧率，模型能够更好地捕捉视频内容的时间动态。<li>不同于其他方法通过增加文本时间戳或引入额外头部实现时间定位，Qwen2.5-VL提出将MRoPE的ID直接与时间戳对齐。该方案允许模型通过时间维度ID之间的间隔理解时间节奏，无需任何额外的计算开销。</ul><h4 id="213-mrope和绝对时间对齐"><span class="mr-2">2.1.3 MRoPE和绝对时间对齐</span><a href="#213-mrope和绝对时间对齐" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4></h4><p>MRoPE：在Qwen2-VL中提出，将位置嵌入分解为三个分量（时间、高度和宽度）</p><ul><li>文本输入，三个分量使用相同的位置ID，等价于1D RoPE<li>图像输入，视觉token的时间ID保持不变，高度和宽度分量根据token在图像中的空间位置分配不同的ID<li>视频输入，视为帧序列，时间ID随每一帧递增，高度和宽度分量与静态图像保持一致</ul><p>问题：Qwen2-VL中MRoPE的时间位置ID仅与输入帧数量相关，不能反映内容变化的速度或视频中事件的绝对时间。</p><p>改进：Qwen2.5-VL中，将MRoPE的时间分量对齐到绝对时间。模型通过利用时间ID之间的间隔，可以在不同FPS采样的视频之间实现一致的时间对齐学习。</p><h3 id="22-预训练"><span class="mr-2">2.2 预训练</span><a href="#22-预训练" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3></h3><h4 id="221-预训练数据"><span class="mr-2">2.2.1 预训练数据</span><a href="#221-预训练数据" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4></h4><p><img src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 2640 902'%3E%3C/svg%3E" width="2640" height="902" alt="image" data-src="https://github.com/user-attachments/assets/e45d7557-71f9-42db-836f-af3b7fb8da70" data-proofer-ignore></p><ul><li>数据规模：1.2T tokens (Qwen2-VL) –&gt; <strong>4T tokens (Qwen2.5-VL)</strong><li>数据类型：图像描述、图文混合数据、OCR数据、视觉知识（如名人、地标、动植物识别）、多模态学术问答、定位数据、文档解析数据、视频描述、视频定位以及基于智能体的交互数据<li>数据来源：清洗原始网页数据、合成数据等</ul><p><strong>图文混合数据</strong><br /> 图文混合数据对于多模态学习至关重要，主要带来三大益处：</p><p>（1）使模型能借助视觉与文本线索实现上下文学习；</p><p>（2）在图片缺失时，保持强大的纯文本能力；</p><p>（3）包含大量通用信息。</p><p>问题：目前可用的图文混合数据大多缺乏有意义的图文关联，且噪声较多，限制了其在复杂推理和创新生成上的作用。</p><p>解决方法：数据打分 &amp; 清洗，确保保留高质量且相关性的图文混合数据。</p><ul><li>流程一：标准数据清洗<li>流程二：内部评测模型打分，打分标准包括：（1）文本质量、（2）图文相关性、（3）图文互补性和（4）信息密度平衡。<ul><li>图文相关性：分数越高，图像与文本间关联越强，图像对于文本能有效补充、解释或扩展，而非仅作装饰。<li>信息互补性：分数越高，图像和文本互为补充，两者各自提供独特细节，共同构成完整语境。<li>信息密度平衡：分数越高，图像与文本的信息分布越均衡，避免单一维度信息过多，保证两者协同。</ul></ul><p><strong>绝对坐标定位数据</strong><br /> 在训练时，Qwen2.5-VL基于输入图片的实际尺寸来表示边框与关键点（绝对坐标而非相对坐标），从而帮助模型更好地把握真实世界中的尺度和空间关联，提升目标检测与定位等任务的表现。</p><p>为提升模型在定位上的泛化能力，联合公开数据集和自有数据，构建了覆盖边框、关键点和指代表达的综合数据集。</p><ul><li>采用多种格式（如XML、JSON和自定义）进行合成，利用复制粘贴增强及现成模型进行合成，从而实现更全面的能力评测和进步。<li>开放词汇目标检测，将训练数据类别扩展至10000+对象。此外，为提升模型在极端目标检测场景下的表现，在查询中合成了不存在的目标类别，并为每个目标类别创建含多个实例的图片数据。<li>为确保模型具备优异的点目标定位能力，构建了涵盖公开及合成数据的点定位数据集。包含PixMo公开的点标记和计数、公开的目标定位（检测和实例分割），以及通过自动化流程生成的针对图片细节精准指点数据。</ul><p><strong>文档全能解析数据</strong></p><ul><li>传统文档解析：专用模型，分别处理版面分析、文本提取、图表理解、插图识别等任务。<li>Qwen2.5-VL：致力于打造通用模型，实现文档结构的解析、理解和格式转化。</ul><p>合成数据</p><p>在文档中融入多种元素，包括表格、图表、公式、自然或合成图片、乐谱及化学表达式，并全部统一为<strong>HTML格式</strong>，借助标签结构描述布局框和插图信息。</p><ul><li>问题：训练的时候输入是HTML渲染出来的图像吗？HTML是用于合成数据的手段？同时也方便获取GT用于模型训练？</ul><p><strong>OCR数据</strong><br /> 合成数据、开源数据和自采数据。</p><ul><li>合成数据：由视觉文本生成引擎自动生成，覆盖多样的真实场景文本图片。<li>开源数据：为支持更多语言，提升多语种能力，引入了大规模多语种OCR数据集，其中涵盖法语、德语、意大利语、西班牙语、葡萄牙语、阿拉伯语、俄语、日语、韩语和越南语等多种语言。该数据集既包含高质量合成图片，也包含真实场景自然图片，保证多文本样式和环境的丰富性，有助于模型在不同语境下展现强适应力。<li>自采数据：<ul><li>针对图表数据，利用matplotlib、seaborn、plotly等可视化库<strong>合成</strong>了100万样本，涵盖柱状图、关系图、热力图等类型。<li>针对表格数据，基于离线端到端表格识别模型处理了600万<strong>真实样本</strong>，过滤出置信度低、重叠及单元格密度不足的表格。</ul></ul><p><strong>视频数据</strong><br /> 为提升模型对不同帧率（FPS）的视频理解能力，在训练阶段动态采样FPS，实现训练样本中FPS的均匀分布。 对于超过半小时的视频，专门通过合成流程生成了多帧字幕。 针对视频锚定，采用了秒级和时分秒帧（hmsf）格式的时间戳，确保模型能准确理解和输出不同时间格式的结果。</p><p><strong>智能体数据</strong><br /> 通过数据采集和合成增强Qwen2.5-VL的感知和决策能力，赋予智能体能力。</p><ul><li>在感知部分，收集了移动端、网页、桌面端的截图，并使用合成引擎生成截图描述和界面元素定位标注。图片描述任务帮助模型理解图形界面，定位任务帮助其对齐元素外观与功能。<li>在决策部分，将手机、网页和桌面端的操作统一为具备共享动作空间的函数调用格式，并基于开源数据及智能体框架在虚拟环境下合成收集多步轨迹，统一重构为函数形式。</ul><h4 id="222-预训练细节"><span class="mr-2">2.2.2 预训练细节</span><a href="#222-预训练细节" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4></h4><p>从零训练一个ViT（使用DataComp数据集&amp;部分自有数据集），作为视觉编码器的初始化；采用预训练好的Qwen2.5作为语言模型的初始化。预训练分为三个阶段（每个阶段采用不同数据配置和训练策略，逐步提升模型能力），如下表所示： <img src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 1720 600'%3E%3C/svg%3E" width="1720" height="600" alt="image" data-src="https://github.com/user-attachments/assets/85921f41-9eb3-48b4-9712-fc902af697e0" data-proofer-ignore></p><ul><li><p><strong>第一阶段</strong>：仅训练ViT，以<strong>增强其与语言模型的对齐性</strong>（促进ViT高效提取能够与文本信息集成的有意义视觉表征），为多模态理解奠定坚实基础。此阶段主要数据来源包括图像描述、视觉知识和OCR数据。</p><li><p><strong>第二阶段</strong>：ViT &amp; LLM，并使用多样化的多模态图像数据进行训练，以<strong>提升模型处理复杂视觉信息的能力</strong>。该阶段引入了更多复杂且具有推理要求的数据集，如图文混合数据、多任务学习数据集、视觉问答（VQA）、多模态数学、智能体相关任务、视频理解和纯文本数据集。这些数据集强化了模型在视觉与语言模态之间建立更深层次联系的能力，使其能够应对日益复杂的任务。</p><li><p><strong>第三阶段</strong>：ViT &amp; LLM，为进一步提升模型在<strong>长序列上的推理能力</strong>，加入了视频和智能体相关数据，同时将序列长度进行扩展。这样，模型能够以更高精度处理更高级和复杂的多模态任务。序列长度的增加，使模型具备了处理更长上下文的能力，尤其有利于依赖长距离信息和复杂推理的任务。</p></ul><p>为应对图片尺寸和文本长度变化给训练带来的计算负载不均等挑战，采用了优化训练效率的策略：基于输入到LLM中的序列长度动态进行数据样本打包，确保负载均衡。</p><ul><li>在第一和第二阶段，数据统一打包为长度8,192的序列；<li>第三阶段则将序列长度扩展至32,768，以匹配模型处理长序列的能力提升。</ul><h3 id="23-后训练sft--dpo"><span class="mr-2">2.3 后训练（SFT + DPO）</span><a href="#23-后训练sft--dpo" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3></h3><p>SFT：通过定向指令优化，缩小预训练表征与下游任务需求之间的差距。采用 ChatML 格式组织指令跟随数据，有意与预训练数据结构差异化。这种格式的转变带来了三项关键适配： 1) 多模态交互中的显式对话角色标记， 2) 视觉嵌入与文本指令的结构化注入， 3) 通过格式感知式打包，保持跨模态位置关系稳定。</p><h4 id="231-指令数据"><span class="mr-2">2.3.1 指令数据</span><a href="#231-指令数据" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4></h4><p>数据量：包含200万条数据，纯文本数据和多模态（图文、视频-文本）数据各占50%。主要以中英文为主，辅以其它语言样本以支持多语种能力。单轮 &amp; 多轮交互；单图像 &amp; 多图像</p><ul><li>多模态数据的引入使模型能够更好地处理复杂输入。<li>尽管纯文本和多模态数据数量相当，但由于视觉和时序信息的嵌入，多模态样本在训练中会消耗更多的tokens和算力。</ul><h4 id="232-数据过滤流程---质量保证"><span class="mr-2">2.3.2 数据过滤流程 - 质量保证</span><a href="#232-数据过滤流程---质量保证" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4></h4><p>两阶段的数据过滤流程：</p><p><strong>第一阶段</strong>：领域分类 - 使用 Qwen2-VL-Instag（由 Qwen2-VL-72B 衍生而来的专用分类模型），对问答（QA）对进行分层归类。将 QA 对划分为8个主要领域（如编程与规划），每个主领域又进一步拆分为30个细分子类。</p><p><strong>第二阶段</strong>：领域定制过滤 - 结合了基于规则和基于模型的方法，综合提升数据质量。由于文档处理、OCR、视觉锚定等领域各自特点不同，可能需采用具体的过滤策略。下述为各领域通用过滤策略简述：</p><ul><li>规则过滤：采用预设启发式规则删除低质量或异常数据。特别针对文档、OCR和锚定任务，识别并去除重复模式，以防止模型学习失真。同时，去除包含不完整、截断或格式错误的响应，这类问题常见于合成及多模态数据中。为确保相关性和遵守伦理规范，任何无关或可能导致有害结果的问答也会被筛除。此结构化流程确保数据既合乎伦理也能满足任务要求。<li>模型过滤：进一步利用 Qwen2.5-VL 系列训练的奖励模型，从多个维度评估多模态 QA 对。查询部分针对复杂度和相关性，仅保留适当挑战且语境相关的示例。答案方面则要求正确、完整、清晰、紧扣问题且具备参考价值。在视觉锚定任务中，尤其关注对视觉信息的准确解读和合理利用。多维度评价保证只有高质量数据进入SFT阶段。</ul><h4 id="233-拒绝采样增强推理---补充高质量cot数据"><span class="mr-2">2.3.3 拒绝采样增强推理 - 补充高质量CoT数据</span><a href="#233-拒绝采样增强推理---补充高质量cot数据" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4></h4><p>为补充结构化数据过滤流程，采用<strong>拒绝采样（Rejection Sampling）策略来优化数据集</strong>，并增强视觉语言模型（VLM）的推理能力。</p><p><strong>拒绝采样</strong>流程始于配有真实标签的数据集，这些任务需要多步推理，如数学问题求解、代码生成和领域特定的VQA。利用中间版本的Qwen2.5-VL模型，将生成的响应与真实答案进行比对。仅保留模型输出与期望答案一致的样本，确保最终数据集由高质量和准确实例组成。</p><ul><li>拒绝采样利用中间Qwen2.5-VL模型生成并筛选高质量答案，保留下来的数据用于后续的SFT（监督微调）训练？</ul><h4 id="234-训练"><span class="mr-2">2.3.4 训练</span><a href="#234-训练" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4></h4><p>Qwen2.5-VL 的后训练流程包含两个阶段：监督微调（SFT）和直接偏好优化（DPO），这两个阶段均保持ViT参数冻结。</p><ul><li>在 SFT 阶段，模型通过多样化的多模态数据进行微调，这些数据包括图文对、视频和纯文本，来源涵盖通用视觉问答（VQA）、<strong>拒绝采样</strong>以及文档与 OCR、锚定、视频和智能体相关任务等专项数据集。<li>DPO 阶段则专注于图文和纯文本数据，利用偏好数据对模型进行优化，使其更贴近人类偏好，并且每个样本只处理一次，以确保高效优化。</ul><p>Qwen3-VL改进：</p><ul><li>一是采用 MRoPE-Interleave，原始MRoPE将特征维度按照时间（t）、高度（h)和宽度（w)的顺序分块划分，使得时间信息全部分布在高频维度上。在 Qwen3-VL 中采取了 t,h,w 交错分布的形式，实现对时间，高度和宽度的全频率覆盖，这样更加鲁棒的位置编码能够保证模型在图片理解能力相当的情况下，提升对长视频的理解能力；<ul><li>[ttthhhwww] -&gt; [thwthwthw]</ul><li>二是引入 DeepStack 技术，<strong>融合 ViT 多层次特征</strong>，提升视觉细节捕捉能力和图文对齐精度；<ul><li>将ViT不同层的视觉特征token化作为视觉输入。这种设计能够有效保留从底层（low-level）到高层（high-level）的丰富视觉信息。（<strong>多层ViT特征</strong>）<ul><li>多层次特征提取：把ViT的第 8 / 16 / 24 层的特征提取出来</ul><li>将LMM单层输入视觉tokens的范式，改为在LLM的多层中进行注入。旨在实现更精细化的视觉理解。（<strong>在LLM中多层注入</strong>）<ul><li>多层特征注入：在LLM的第 0 / 1 / 2 层的 forward 结束以后，加上提取的 8 / 16 / 24 层的多层次特征</ul></ul><li>三是将原有的视频时序建模机制 T-RoPE 升级为 文本时间戳对齐机制。<ul><li>采用“时间戳-视频帧”交错的输入形式，实现帧级别的<strong>时间信息与视觉内容的细粒度对齐</strong>。<li>原生支持“秒数”与“时:分:秒”（HMS）两种时间输出格式。</ul></ul><p><img data-src="https://qianwen-res.oss-accelerate.aliyuncs.com/Qwen3-VL/qwen3vl_arc.jpg" alt="Qwen3-VL架构图" data-proofer-ignore></p></div><div class="post-tail-wrapper text-muted"><div class="post-meta mb-3"> <i class="far fa-folder-open fa-fw mr-1"></i> <a href='/categories/blogs/'>Blogs</a>, <a href='/categories/basicknow/'>BasicKnow</a>, <a href='/categories/llm/'>LLM</a></div><div class="post-tags"> <i class="fa fa-tags fa-fw mr-1"></i> <a href="/tags/basicknow/" class="post-tag no-text-decoration" >BasicKnow</a></div><div class="post-tail-bottom d-flex justify-content-between align-items-center mt-3 pt-5 pb-2"><div class="license-wrapper"> This post is licensed under <a href="https://creativecommons.org/licenses/by/4.0/"> CC BY 4.0 </a> by the author.</div><div class="share-wrapper"> <span class="share-label text-muted mr-1">Share</span> <span class="share-icons"> <a href="https://twitter.com/intent/tweet?text=Qwen-VL - Yiyu Wang&amp;url=https://232525.github.io/posts/Qwen-VL/" data-toggle="tooltip" data-placement="top" title="Twitter" target="_blank" rel="noopener" aria-label="Twitter"> <i class="fa-fw fab fa-twitter"></i> </a> <a href="https://www.facebook.com/sharer/sharer.php?title=Qwen-VL - Yiyu Wang&amp;u=https://232525.github.io/posts/Qwen-VL/" data-toggle="tooltip" data-placement="top" title="Facebook" target="_blank" rel="noopener" aria-label="Facebook"> <i class="fa-fw fab fa-facebook-square"></i> </a> <a href="https://t.me/share/url?url=https://232525.github.io/posts/Qwen-VL/&amp;text=Qwen-VL - Yiyu Wang" data-toggle="tooltip" data-placement="top" title="Telegram" target="_blank" rel="noopener" aria-label="Telegram"> <i class="fa-fw fab fa-telegram"></i> </a> <i id="copy-link" class="fa-fw fas fa-link small" data-toggle="tooltip" data-placement="top" title="Copy link" data-title-succeed="Link copied successfully!"> </i> </span></div></div></div></div></div><div id="panel-wrapper" class="col-xl-3 pl-2 text-muted"><div class="access"><div id="access-lastmod" class="post"><div class="panel-heading">Recently Updated</div><ul class="post-content pl-0 pb-1 ml-1 mt-2"><li><a href="/posts/Qwen-VL/">Qwen-VL</a><li><a href="/posts/DeepSeek-OCR/">DeepSeek-OCR论文阅读记录</a><li><a href="/posts/BBPE/">BBPE笔记记录</a><li><a href="/posts/RoPE-YARN/">RoPE + YARN</a><li><a href="/posts/%E5%9B%9B%E7%A7%8DNormalization%E7%9A%84%E8%AE%A1%E7%AE%97%E5%B7%AE%E5%BC%82/">四种Normalization的计算差异</a></ul></div><div id="access-tags"><div class="panel-heading">Trending Tags</div><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/algorithm/">algorithm</a> <a class="post-tag" href="/tags/basicknow/">BasicKnow</a> <a class="post-tag" href="/tags/leetcode/">leetcode</a> <a class="post-tag" href="/tags/touchfish/">touchfish</a> <a class="post-tag" href="/tags/%E7%8E%AF%E5%A2%83%E9%85%8D%E7%BD%AE/">环境配置</a> <a class="post-tag" href="/tags/daily/">Daily</a> <a class="post-tag" href="/tags/normalization/">Normalization</a> <a class="post-tag" href="/tags/pytorch/">pytorch</a></div></div></div><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.js"></script><div id="toc-wrapper" class="pl-0 pr-4 mb-5"><div class="panel-heading pl-3 pt-2 mb-2">Contents</div><nav id="toc" data-toggle="toc"></nav></div></div></div><div class="row"><div class="col-12 col-lg-11 col-xl-8"><div id="tail-wrapper" class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><div id="related-posts" class="mt-5 mb-2 mb-sm-4"><h3 class="pt-2 mt-1 mb-4 ml-1" data-toc-skip>Further Reading</h3><div class="card-deck mb-4"><div class="card"> <a href="/posts/RoPE-YARN/"><div class="card-body"> <em class="timeago small" data-ts="1755619200" > 2025-08-20 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>RoPE + YARN</h3><div class="text-muted small"><p> 1. RoPE（旋转位置编码） 将二维向量 $(x_1, x_2)$ 绕原点旋转 $\theta$ 角度，用矩阵乘法表示如下： [\begin{pmatrix} x_1’ \ x_2’ \end{pmatrix} = \begin{pmatrix} \cos\theta &amp;amp; -\sin\theta \sin\theta &amp;amp; \cos\theta \end{pmatr...</p></div></div></a></div><div class="card"> <a href="/posts/BBPE/"><div class="card-body"> <em class="timeago small" data-ts="1758816000" > 2025-09-26 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>BBPE笔记记录</h3><div class="text-muted small"><p> Code: https://github.com/OctopusMind/BBPE 1、正则表达式分词 支持多语种分词 pat_str = r&quot;&#39;s|&#39;t|&#39;re|&#39;ve|&#39;m|&#39;ll|&#39;d| ?[\p{L}]+| ?[\p{N}]+| ?[^\s\p{L}\p{N}]+|\s+(?!\S)|\s+&quot; 各部分含义如下： &#39;s|&#39;t|&#39;re|&#39;ve|&#39;m|&#39;ll|&#39;d ...</p></div></div></a></div><div class="card"> <a href="/posts/DeepSeek-OCR/"><div class="card-body"> <em class="timeago small" data-ts="1760976000" > 2025-10-21 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>DeepSeek-OCR论文阅读记录</h3><div class="text-muted small"><p> 论文标题：DeepSeek-OCR: Contexts Optical Compression 核心： 光学2D映射（optical 2D mapping） –&amp;gt; 上下文压缩 一页包含1000个单词的图像，其视觉编码所需的视觉tokens数可以远小于编码该1000个单词所需的文本tokens数 模型构成：Encoder-Decoder结...</p></div></div></a></div></div></div><div class="post-navigation d-flex justify-content-between"> <a href="/posts/DeepSeek-OCR/" class="btn btn-outline-primary" prompt="Older"><p>DeepSeek-OCR论文阅读记录</p></a> <span class="btn btn-outline-primary disabled" prompt="Newer"><p>-</p></span></div><script type="text/javascript"> $(function () { const origin = "https://giscus.app"; const iframe = "iframe.giscus-frame"; const lightTheme = "light"; const darkTheme = "dark_dimmed"; let initTheme = lightTheme; if ($("html[data-mode=dark]").length > 0 || ($("html[data-mode]").length == 0 && window.matchMedia("(prefers-color-scheme: dark)").matches)) { initTheme = darkTheme; } let giscusAttributes = { "src": "https://giscus.app/client.js", "data-repo": "232525/232525.github.io", "data-repo-id": "R_kgDOHDi0nw", "data-category": "Announcements", "data-category-id": "DIC_kwDOHDi0n84COcbz", "data-mapping": "pathname", "data-reactions-enabled": "1", "data-emit-metadata": "0", "data-theme": initTheme, "data-input-position": "bottom", "data-lang": "en", "crossorigin": "anonymous", "async": "" }; let giscusScript = document.createElement("script"); Object.entries(giscusAttributes).forEach(([key, value]) => giscusScript.setAttribute(key, value)); document.getElementById("tail-wrapper").appendChild(giscusScript); addEventListener("message", (event) => { if (event.source === window && event.data && event.data.direction === ModeToggle.ID) { /* global theme mode changed */ const mode = event.data.message; const theme = (mode === ModeToggle.DARK_MODE ? darkTheme : lightTheme); const message = { setConfig: { theme: theme } }; const giscus = document.querySelector(iframe).contentWindow; giscus.postMessage({ giscus: message }, origin); } }); }); </script></div></div></div><footer class="d-flex w-100 justify-content-center"><div class="d-flex justify-content-between align-items-center text-muted"><div class="footer-left"><p class="mb-0"> © 2025 <a href="https://github.com/232525">Yiyu Wang</a>. <span data-toggle="tooltip" data-placement="top" title="Except where otherwise noted, the blog posts on this site are licensed under the Creative Commons Attribution 4.0 International (CC BY 4.0) License by the author.">Some rights reserved.</span></p></div><div class="footer-right"><p class="mb-0"> Powered by <a href="https://jekyllrb.com" target="_blank" rel="noopener">Jekyll</a> with <a href="https://github.com/cotes2020/jekyll-theme-chirpy" target="_blank" rel="noopener">Chirpy</a> theme.</p></div></div></footer></div><div id="search-result-wrapper" class="d-flex justify-content-center unloaded"><div class="col-12 col-sm-11 post-content"><div id="search-hints"><div id="access-tags"><div class="panel-heading">Trending Tags</div><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/algorithm/">algorithm</a> <a class="post-tag" href="/tags/basicknow/">BasicKnow</a> <a class="post-tag" href="/tags/leetcode/">leetcode</a> <a class="post-tag" href="/tags/touchfish/">touchfish</a> <a class="post-tag" href="/tags/%E7%8E%AF%E5%A2%83%E9%85%8D%E7%BD%AE/">环境配置</a> <a class="post-tag" href="/tags/daily/">Daily</a> <a class="post-tag" href="/tags/normalization/">Normalization</a> <a class="post-tag" href="/tags/pytorch/">pytorch</a></div></div></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div><script src="https://cdn.jsdelivr.net/npm/mermaid@8/dist/mermaid.min.js"></script> <script> $(function() { function updateMermaid(event) { if (event.source === window && event.data && event.data.direction === ModeToggle.ID) { const mode = event.data.message; if (typeof mermaid === "undefined") { return; } let expectedTheme = (mode === ModeToggle.DARK_MODE? "dark" : "default"); let config = { theme: expectedTheme }; /* Re-render the SVG › <https://github.com/mermaid-js/mermaid/issues/311#issuecomment-332557344> */ $(".mermaid").each(function() { let svgCode = $(this).prev().children().html(); $(this).removeAttr("data-processed"); $(this).html(svgCode); }); mermaid.initialize(config); mermaid.init(undefined, ".mermaid"); } } let initTheme = "default"; if ($("html[data-mode=dark]").length > 0 || ($("html[data-mode]").length == 0 && window.matchMedia("(prefers-color-scheme: dark)").matches ) ) { initTheme = "dark"; } let mermaidConf = { theme: initTheme /* <default|dark|forest|neutral> */ }; /* Markdown converts to HTML */ $("pre").has("code.language-mermaid").each(function() { let svgCode = $(this).children().html(); $(this).addClass("unloaded"); $(this).after(`<div class=\"mermaid\">${svgCode}</div>`); }); mermaid.initialize(mermaidConf); window.addEventListener("message", updateMermaid); }); </script><div id="mask"></div><a id="back-to-top" href="#" aria-label="back-to-top" class="btn btn-lg btn-box-shadow" role="button"> <i class="fas fa-angle-up"></i> </a> <script src="https://cdn.jsdelivr.net/npm/simple-jekyll-search@1.10.0/dest/simple-jekyll-search.min.js"></script> <script> SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/assets/js/data/search.json', searchResultTemplate: '<div class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-lg-4 pr-lg-4 pl-xl-0 pr-xl-0"> <a href="{url}">{title}</a><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"> {categories} {tags}</div><p>{snippet}</p></div>', noResultsText: '<p class="mt-5">Oops! No result founds.</p>', templateMiddleware: function(prop, value, template) { if (prop === 'categories') { if (value === '') { return `${value}`; } else { return `<div class="mr-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`; } } if (prop === 'tags') { if (value === '') { return `${value}`; } else { return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`; } } } }); </script> <script src="https://cdn.jsdelivr.net/combine/npm/magnific-popup@1/dist/jquery.magnific-popup.min.js,npm/lozad/dist/lozad.min.js,npm/clipboard@2/dist/clipboard.min.js"></script> <script src="https://cdn.jsdelivr.net/combine/npm/dayjs@1/dayjs.min.js,npm/dayjs@1/locale/en.min.js,npm/dayjs@1/plugin/relativeTime.min.js,npm/dayjs@1/plugin/localizedFormat.min.js"></script> <script defer src="/assets/js/dist/post.min.js"></script> <script> /* see: <https://docs.mathjax.org/en/latest/options/input/tex.html#tex-options> */ MathJax = { tex: { inlineMath: [ /* start/end delimiter pairs for in-line math */ ['$','$'], ['\\(','\\)'] ], displayMath: [ /* start/end delimiter pairs for display math */ ['$$', '$$'], ['\\[', '\\]'] ] } }; </script> <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script> <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml.js"> </script> <script src="https://cdn.jsdelivr.net/npm/bootstrap@4/dist/js/bootstrap.bundle.min.js"></script> <script defer src="/app.js"></script>
